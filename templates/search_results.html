{% extends "base.html" %}{% block content %}
<h2>Results for “{{ query }}”</h2>

<div class="grid">
{% for t in tracks %}
  <div class="card">
    <h3>{{ t.name }}</h3>
    <p class="meta">{{ t.artist }}</p>

    <a href="{% url 'similar' %}?artist={{ t.artist|urlencode:"" }}&track={{ t.name|urlencode:"" }}">Similar</a>
    ·
    <a href="{% url 'deepcut' %}?artist={{ t.artist|urlencode:"" }}&track={{ t.name|urlencode:"" }}">Deep-cut</a>
    ·
    <a href="{% url 'track_detail' t.artist|urlencode:"" t.name|urlencode:"" %}">Play</a>

    {% if request.user.is_authenticated %}
      <form action="{% url 'playlist_add' %}" method="post" style="margin-top:6px">
        {% csrf_token %}
        <input type="hidden" name="artist" value="{{ t.artist }}">
        <input type="hidden" name="track"  value="{{ t.name  }}">
        <select name="playlist"
                onchange="this.nextElementSibling.style.display=this.value=='__new__'?'inline':'none'">
          {% for pl in request.user.playlists.all %}
            <option value="{{ pl.id }}">{{ pl.name }}</option>
          {% endfor %}
          <option value="__new__">＋ New playlist…</option>
        </select>
        <input name="new_name" style="display:none" placeholder="Playlist name">
        <button>Add</button>
      </form>
    {% endif %}
  </div>
{% empty %}
  <p>No results found.</p>
{% endfor %}
</div>
{% endblock %}
