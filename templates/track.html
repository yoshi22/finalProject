{#  templates/track.html  #}
{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<a href="{% url 'home' %}"
   class="back-btn"
   onclick="event.preventDefault();
            if (history.length > 1) { history.back(); }
            else { window.location = this.getAttribute('href'); }">
  ← Back
</a>

{% if title %}
  <h2>{{ title }}</h2>
  <p class="meta">
      {{ artist }} · Plays: {{ playcount|intcomma }}
  </p>

  {# ---------- 30-sec Apple preview + YouTube full link ---------- #}
  {% if apple_preview or youtube_url %}
      <details style="margin-top:.5rem; max-width:360px">
          <summary style="cursor:pointer; font-weight:600">
              ▶︎ Preview / YouTube
          </summary>
          <div style="margin-top:.6rem">
              {% comment %}Apple Music 30 sec audio{% endcomment %}
              {% if apple_preview %}
                  <audio controls style="width:100%">
                      <source src="{{ apple_preview }}" type="audio/mpeg">
                  </audio>
                  <p style="font-size:.75rem;color:var(--muted);margin-top:2px">
                      30-second preview by Apple Music
                  </p>
              {% endif %}

              {% comment %}YouTube full track{% endcomment %}
              {% if youtube_url %}
                  <div style="margin-top:.4rem">
                      <a href="{{ youtube_url }}" target="_blank" rel="noopener">
                          ▶︎ Full track on YouTube
                      </a>
                  </div>
              {% endif %}
          </div>
      </details>
  {% else %}
      <p><em>No preview available.</em></p>
  {% endif %}

  <div class="card" style="margin-top:1rem">
      {{ summary|safe }}
  </div>
{% else %}
  <p>Could not fetch track information.</p>
{% endif %}
{% endblock %}
